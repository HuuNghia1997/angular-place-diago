<div class="head">
    <h2 id="title">Chi tiết thông báo</h2>
    <button mat-raised-button (click)="addRecord()">
      <mat-icon>add</mat-icon> Thêm mới
    </button>
</div>
<div class="main-wrapper mat-elevation-z4">
    <h2 id="title" class="mb-1">{{notificationTitle}}</h2>
    <div class="control mb-2">
        <button mat-raised-button *ngFor='let status of notificationStatus;' [disabled]="status.status == 1" (click)="updateRecord()">
        <mat-icon>edit</mat-icon> Cập nhật
      </button>
        <button class="ml-1" mat-raised-button *ngFor='let status of notificationStatus;' [disabled]="status.status == 1" (click)="deleteRecord()">
        <mat-icon>delete</mat-icon> Xoá
      </button>
        <button class="ml-1 primary-blue-btn" mat-raised-button *ngFor='let status of notificationStatus;' [disabled]="status.status == 1" (click)="sendNotification()">
        <mat-icon>send</mat-icon> Gửi đi
      </button>
    </div>
    <div class="notification_content">
        <!-- Left -->
        <div class="left_content">
            <!-- Thông tin thông báo -->
            <div class="content_item mb-4">
                <h4 id="title">Thông tin thông báo</h4>
                <div class="notification_detail">
                    <span>Đơn vị:</span>
                    <span class="f-w-500" *ngFor='let agency of notificationAgency;'>{{agency.name}}</span>
                </div>
                <div class="notification_detail">
                    <span>Trạng thái:</span>
                    <span *ngFor='let status of notificationStatus;' [ngClass]="{'status_unsent': status.status == 0, 'status_sent': status.status == 1}">{{ status.description }}</span>
                </div>
                <div class="notification_tags">
                    <span>Chuyên mục:</span>
                    <div class="listtags">
                        <div class="catalogy" *ngFor='let tags of notificationTags;'>{{tags.name}}</div>
                    </div>
                </div>
            </div>
            <!-- Nội dung -->
            <div class="content_item mb-4">
                <h4 id="title">Nội dung</h4>
                <span>{{notificationContent}}</span>
            </div>
            <!-- Hình ảnh -->
            <div class="content_item mb-4">
                <h4 id="title">Hình ảnh</h4>
                <div [ngClass]="{'img_uploaded': uploaded == true}">
                    <div class="drag_upload_btn" [ngClass]="{'no_boder': uploaded == true}">
                        <button mat-button [ngClass]="{'btn_uploaded': uploaded == true, 'clear_img_queue': uploaded == false}">
                <mat-icon>cloud_upload</mat-icon>
                Kéo thả tệp tin hoặc <a href="">Chọn từ thư viện</a> hoặc <a href="">Tải lên</a>
              </button>
                        <input id="img_upload" name="img_upload[]" type='file' (change)="onSelectFile($event)" multiple accept=".JPG, .PNG, .JPEG" value="{{blankVal}}">
                    </div>
                    <div class="image_drag_upload_preview">
                        <div class="list_uploaded" *ngFor='let url of urls; let i = index;'>
                            <div class="img_items  mat-elevation-z4" [ngStyle]="{'background-image': 'url('+ urls[i] +')'}">
                            </div>
                            <div class="img_control">
                                <span class="file_name" matTooltip="{{fileNamesFull[i]}}" [matTooltipPosition]="'right'">{{fileNames[i]}}</span>
                                <a mat-icon-button class="delete_img" align="end">
                                    <mat-icon (click)="removeItem(i)">delete_outline</mat-icon>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Hoạt động -->
            <div class="content_item mb-4" id="history_tab">
                <h4 id="title">Hoạt động</h4>
                <mat-tab-group>
                    <mat-tab label="Lịch sử">
                        <div class="history">
                            <div *ngFor='let his of history; let i = index;' class="history_item mt-1">
                                <span><a href="">{{his.user.name}}</a>
                    <span *ngIf="his.type === 1"> đã bình luận</span>
                                <span *ngIf="his.type === 2"> đã chuyển bước</span>
                                <span *ngIf="his.type === 3"> đã thay đổi</span>
                                <span *ngIf="his.type === 4"> đã thêm mới</span>
                                <span *ngIf="his.type === 5"> đã xoá</span> - {{his.affectedDate | date : 'dd/MM/yyyy HH:mm:ss' }}</span>
                                <div class="history_content mt-1" [ngClass]="{'d-none':  his.type === 4}">
                                    <div style="width: 20%">
                                        <b>Trường</b>
                                    </div>
                                    <div style="width: 30%">
                                        <b>Giá trị cũ</b>
                                    </div>
                                    <div style="width: 30%">
                                        <b>Giá trị mới</b>
                                    </div>
                                </div>
                                <div class="history_content mt-1" *ngFor="let his_item of his.action" [ngClass]="{'d-none':  his.type === 4}">
                                    <div style="width: 20%">
                                        <p>{{his_item.fieldName}}</p>
                                    </div>
                                    <div style="width: 30%">
                                        <p>{{his_item.originalValue}}</p>
                                    </div>
                                    <div style="width: 30%">
                                        <p>{{his_item.newValue}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </mat-tab>
                </mat-tab-group>
            </div>
        </div>
        <!-- Right -->
        <div class="right_content">
            <div class="content_item">
                <h4 id="title"> </h4>
                <div class="notification_detail">
                    <span>Ngày tạo:</span>
                    <span class="f-w-500">{{notificationCreatedDate | date : 'dd/MM/yyyy HH:mm:ss' }}</span>
                </div>
                <div class="notification_detail">
                    <span>Ngày gửi:</span>
                    <span class="f-w-500">{{notificationPublishedDate | date : 'dd/MM/yyyy HH:mm:ss' }}</span>
                </div>
                <div class="notification_detail">
                    <span>Ngày hết hạn:</span>
                    <span class="f-w-500">{{notificationExpiredDate | date : 'dd/MM/yyyy HH:mm:ss' }}</span>
                </div>
            </div>
        </div>
    </div>
</div>